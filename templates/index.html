<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" class="js-site-favicon" type="image/png" href="./static/HiveCompute_Icon_RGB.png">
    <title>Hive &ndash; Distributed Inference PoC</title>
    <link href="./static/bootstrap.min.css" rel="stylesheet">
    <link href="./static/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const hiveForm = document.getElementById("hivediskForm");
        const loadingIndicator2 = document.getElementById("loading-indicator2");
        const resultMessage2 = document.getElementById("result-message2");

        hiveForm.addEventListener("submit", function (event) {
          event.preventDefault();
          const formData = new FormData(hiveForm);
          resultMessage2.style.display = "none";

          loadingIndicator2.style.display = "block";
          loadingIndicator2.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';

          fetch("/api/v1/gethivedisk", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.text())
            .then((responseText) => {
              loadingIndicator2.style.display = "none";

              if (responseText.trim() === "OK") {
                resultMessage2.style.color = "green";
              } else {
                resultMessage2.style.color = "red";
              }

              resultMessage2.textContent = responseText;
              resultMessage2.style.display = "block";
            })
            .catch((error) => {
              console.error("Error updating from Kaggle:", error);
              loadingIndicator2.style.display = "none";
              resultMessage2.style.display = "none";
            });
        });
      });
    </script>
  </head>
  <body class="dark-mode">

<main>
  <div class="position-relative overflow-hidden px-5 pt-1 m-md-4 text-center">
    <div class="col-lg-6 col-md-8 p-md-3 mx-auto my-3" style="max-width: 700px;">
      <div class="mb-4">
        <div class="d-md-inline-block pe-md-4" >
          <a target="_blank" href="https://hivenet.com" ><img src="./static/HiveCompute_Icon_RGB.png" height="50" ></a>
        </div>
        <h1 class="display-4 fw-bold d-md-inline-block white-color justify-content-center" style="font-size: 40pt; vertical-align: middle;">
          hive
          <span style="font-size: 25pt; color: #e1ff01;">Chat</span>  <span style="font-size: 12pt; color: #c9d0d7df;">(Kaggle <a target="_blank" href="https://www.kaggle.com/datasets/rtatman/questionanswer-dataset/data"> QA/Wikipedia Dataset</a>)</span>
        </h1>
      </div>
      <div class="welcome mb-4">
        <div>
          <b>Welcome!</b> This is a RAG app running
          <a target="_blank" class="model-name" href="{{ default_model.frontend.model_card }}">{{ default_model.frontend.name }}</a> model.
          over a private <a target="_blank" href="http://57.128.41.80:31888/">cluster</a>.
        </div>
        <form id="settings">
          <div class="mt-2">
            <label class="group-label">Family:</label>
            <div class="btn-group family-selector" role="group">
              {% for family in model_families.keys() %}
              {% set family_id = family.lower().replace(" ", "-") %}
              <input type="radio" class="btn-check" name="family" value="{{ family_id }}" id="family-{{ family_id }}"
                  {% if loop.first %}checked{% endif %}>
              <label class="btn btn-outline-primary" for="family-{{ family_id }}">{{ family }}</label>
              {% endfor %}
            </div>
          </div>
          <div class="mt-2">
            <label class="group-label">Model:</label>
            {% for family, family_models in model_families.items() %}
            {% set family_id = family.lower().replace(" ", "-") %}
            {% set family_loop = loop %}
            <div class="model-selector btn-group" role="group" data-family="{{ family_id }}"
                {% if not loop.first %}style="display: none;"{% endif %}>
              {% for model in family_models %}
              {% set model_id = model.backend.key.lower().replace("/", "-") %}
              <input type="radio" class="btn-check" name="model" value="{{ model.backend.key }}" id="{{ model_id }}"
                  {% if family_loop.first and loop.first %}checked{% endif %}>
              <label class="btn btn-outline-primary" for="{{ model_id }}">{{ model.frontend.name }}</label>
              {% endfor %}
            </div>
            {% endfor %}
          </div>
        </form>
        <br>
        <div>
          <form id="hivediskForm" method="POST" action="">
            <div class="form-group">
              <label for="loadButton"><b>Update From Kaggle:</b></label>
              <div class="submit-container">
                <input type="submit" id="loadButton" value="Load">
                <div id="loading-indicator2"></div>
              </div>
            </div>
          </form>
        </div>
        <div id="result-message2" style="color: red;"></div>

      </div>
      
      <div class="dialogue">
        <p class="human-replica">A chat between a curious human and an AI assistant.</p>
        <p class="ai-replica"><span class="text">Assistant: Hi! How can I help you?</span></p>
        <p class="human-replica"><textarea class="form-control" id="exampleTextarea" rows="2">Human: </textarea></p>
      </div>
      
      <p class="error-box" style="display: none;">
        Request failed. <a class="retry-link" href="#">Retry</a><br>
        <span class="error-message"></span>
        <span class="out-of-capacity"><br>
          <b>We're out of capacity</b> &mdash; attention caches of existing servers are full.
        </span>
      </p>

    </div>
  </div>
</main>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="./static/autosize.min.js"></script>

    <script>
      const modelConfigs = {{ model_config_json|safe }};
      const defaultModel = {{ default_model.backend.key|tojson|safe }};
    </script>
    <script src="./static/chat.js?v=18"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LENBCEYH86"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-LENBCEYH86');
    </script>
  </body>
</html>